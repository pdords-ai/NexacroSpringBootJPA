<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nexacro ê³ ê¸‰ ê¸°ëŠ¥ - ì›Œí¬í”Œë¡œìš°ì™€ ìƒíƒœ ê´€ë¦¬</title>
    <script type="text/javascript" src="http://localhost:8080/nexacro/nexacro.js"></script>
</head>
<body>
    <script type="text/javascript">
        /*
            ===== ì›Œí¬í”Œë¡œìš°ì™€ ìƒíƒœ ê´€ë¦¬ ì˜ˆì œ =====
            
            ì´ ì˜ˆì œì—ì„œëŠ” ë‹¤ìŒì„ ë°°ì›ë‹ˆë‹¤:
            1. ìƒíƒœ ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° êµ¬í˜„
            2. ìƒíƒœ ì „í™˜ ê´€ë¦¬
            3. ê¶Œí•œ ê¸°ë°˜ ì•¡ì…˜ ì œì–´
            4. ìƒíƒœ íˆìŠ¤í† ë¦¬ ì¶”ì 
            5. ì•Œë¦¼ê³¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
            6. ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ êµ¬í˜„
            7. ìƒíƒœ ì‹œê°í™”
        */
        function on_application_ready() {
            
            /*
                ===== 1ë‹¨ê³„: ë°ì´í„°ì…‹ ì„¤ì • =====
            */
            
            // ë¬¸ì„œ ë°ì´í„°ì…‹
            var documentDataset = new nexacro.Dataset("documentDataset");
            documentDataset.addColumn("docId", "number");
            documentDataset.addColumn("title", "string");
            documentDataset.addColumn("content", "string");
            documentDataset.addColumn("author", "string");
            documentDataset.addColumn("createDate", "string");
            documentDataset.addColumn("currentStatus", "string");
            documentDataset.addColumn("priority", "string");
            documentDataset.addColumn("assignee", "string");
            
            // ìƒíƒœ íˆìŠ¤í† ë¦¬ ë°ì´í„°ì…‹
            var statusHistoryDataset = new nexacro.Dataset("statusHistoryDataset");
            statusHistoryDataset.addColumn("historyId", "number");
            statusHistoryDataset.addColumn("docId", "number");
            statusHistoryDataset.addColumn("fromStatus", "string");
            statusHistoryDataset.addColumn("toStatus", "string");
            statusHistoryDataset.addColumn("action", "string");
            statusHistoryDataset.addColumn("user", "string");
            statusHistoryDataset.addColumn("timestamp", "string");
            statusHistoryDataset.addColumn("comment", "string");
            
            // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
            var sampleDocuments = [
                {docId: 1, title: "í”„ë¡œì íŠ¸ ê³„íšì„œ", content: "ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ê³„íšì„œì…ë‹ˆë‹¤.", author: "ê¹€ì² ìˆ˜", createDate: "2024-01-15", currentStatus: "ì‘ì„±ì¤‘", priority: "ë†’ìŒ", assignee: "ê¹€ì² ìˆ˜"},
                {docId: 2, title: "ì˜ˆì‚° ìŠ¹ì¸ ìš”ì²­", content: "Q1 ì˜ˆì‚° ìŠ¹ì¸ì„ ìš”ì²­í•©ë‹ˆë‹¤.", author: "ì´ì˜í¬", createDate: "2024-01-16", currentStatus: "ê²€í† ì¤‘", priority: "ì¤‘ê°„", assignee: "ë°•ë¯¼ìˆ˜"},
                {docId: 3, title: "ì‹œìŠ¤í…œ ê°œì„ ì•ˆ", content: "ì‹œìŠ¤í…œ ì„±ëŠ¥ ê°œì„  ë°©ì•ˆì…ë‹ˆë‹¤.", author: "ë°•ë¯¼ìˆ˜", createDate: "2024-01-17", currentStatus: "ìŠ¹ì¸ëŒ€ê¸°", priority: "ë‚®ìŒ", assignee: "ì •ìˆ˜ì§„"},
                {docId: 4, title: "êµìœ¡ ê³„íš", content: "ì§ì› êµìœ¡ ê³„íšì„œì…ë‹ˆë‹¤.", author: "ì •ìˆ˜ì§„", createDate: "2024-01-18", currentStatus: "ì™„ë£Œ", priority: "ì¤‘ê°„", assignee: "ìµœì˜í˜¸"},
                {docId: 5, title: "ë³´ê³ ì„œ", content: "ì›”ê°„ ë³´ê³ ì„œì…ë‹ˆë‹¤.", author: "ìµœì˜í˜¸", createDate: "2024-01-19", currentStatus: "ë°˜ë ¤", priority: "ë†’ìŒ", assignee: "ê¹€ì² ìˆ˜"}
            ];
            
            var sampleHistory = [
                {historyId: 1, docId: 1, fromStatus: "ì‹ ê·œ", toStatus: "ì‘ì„±ì¤‘", action: "ì‘ì„±ì‹œì‘", user: "ê¹€ì² ìˆ˜", timestamp: "2024-01-15 09:00", comment: "ë¬¸ì„œ ì‘ì„± ì‹œì‘"},
                {historyId: 2, docId: 2, fromStatus: "ì‘ì„±ì¤‘", toStatus: "ê²€í† ì¤‘", action: "ì œì¶œ", user: "ì´ì˜í¬", timestamp: "2024-01-16 10:30", comment: "ê²€í†  ìš”ì²­"},
                {historyId: 3, docId: 3, fromStatus: "ê²€í† ì¤‘", toStatus: "ìŠ¹ì¸ëŒ€ê¸°", action: "ê²€í† ì™„ë£Œ", user: "ë°•ë¯¼ìˆ˜", timestamp: "2024-01-17 14:20", comment: "ìŠ¹ì¸ ìš”ì²­"},
                {historyId: 4, docId: 4, fromStatus: "ìŠ¹ì¸ëŒ€ê¸°", toStatus: "ì™„ë£Œ", action: "ìŠ¹ì¸", user: "ì •ìˆ˜ì§„", timestamp: "2024-01-18 11:15", comment: "ìŠ¹ì¸ ì™„ë£Œ"},
                {historyId: 5, docId: 5, fromStatus: "ìŠ¹ì¸ëŒ€ê¸°", toStatus: "ë°˜ë ¤", action: "ë°˜ë ¤", user: "ìµœì˜í˜¸", timestamp: "2024-01-19 16:45", comment: "ìˆ˜ì • í•„ìš”"}
            ];
            
            // ë°ì´í„°ì…‹ì— ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€
            for (var i = 0; i < sampleDocuments.length; i++) {
                var doc = sampleDocuments[i];
                var newRow = documentDataset.addRow();
                documentDataset.setCellData(newRow, "docId", doc.docId);
                documentDataset.setCellData(newRow, "title", doc.title);
                documentDataset.setCellData(newRow, "content", doc.content);
                documentDataset.setCellData(newRow, "author", doc.author);
                documentDataset.setCellData(newRow, "createDate", doc.createDate);
                documentDataset.setCellData(newRow, "currentStatus", doc.currentStatus);
                documentDataset.setCellData(newRow, "priority", doc.priority);
                documentDataset.setCellData(newRow, "assignee", doc.assignee);
            }
            
            for (var i = 0; i < sampleHistory.length; i++) {
                var history = sampleHistory[i];
                var newRow = statusHistoryDataset.addRow();
                statusHistoryDataset.setCellData(newRow, "historyId", history.historyId);
                statusHistoryDataset.setCellData(newRow, "docId", history.docId);
                statusHistoryDataset.setCellData(newRow, "fromStatus", history.fromStatus);
                statusHistoryDataset.setCellData(newRow, "toStatus", history.toStatus);
                statusHistoryDataset.setCellData(newRow, "action", history.action);
                statusHistoryDataset.setCellData(newRow, "user", history.user);
                statusHistoryDataset.setCellData(newRow, "timestamp", history.timestamp);
                statusHistoryDataset.setCellData(newRow, "comment", history.comment);
            }
            
            /*
                ===== 2ë‹¨ê³„: UI ì»´í¬ë„ŒíŠ¸ë“¤ ë§Œë“¤ê¸° =====
            */
            
            // ì œëª©
            var titleLabel = new nexacro.Label("titleLabel");
            titleLabel.set_text("ì›Œí¬í”Œë¡œìš°ì™€ ìƒíƒœ ê´€ë¦¬ - ë¬¸ì„œ ìŠ¹ì¸ ì‹œìŠ¤í…œ");
            titleLabel.set_left(50);
            titleLabel.set_top(20);
            titleLabel.set_width(800);
            titleLabel.set_height(40);
            titleLabel.set_font("bold 18px Arial");
            titleLabel.set_color("darkblue");
            titleLabel.set_background("lightblue");
            
            // ë©”ì¸ ì»¨í…Œì´ë„ˆ
            var mainContainer = new nexacro.Container("mainContainer");
            mainContainer.set_left(50);
            mainContainer.set_top(70);
            mainContainer.set_width(1000);
            mainContainer.set_height(600);
            mainContainer.set_background("white");
            mainContainer.set_border("2px solid #ccc");
            
            // ë¬¸ì„œ ëª©ë¡ ê·¸ë¦¬ë“œ
            var documentGrid = new nexacro.Grid("documentGrid");
            documentGrid.set_left(10);
            documentGrid.set_top(10);
            documentGrid.set_width(600);
            documentGrid.set_height(250);
            documentGrid.set_border("1px solid #ccc");
            documentGrid.set_dataset(documentDataset);
            
            documentGrid.addColumn("docId", "ë¬¸ì„œID", 80);
            documentGrid.addColumn("title", "ì œëª©", 150);
            documentGrid.addColumn("author", "ì‘ì„±ì", 80);
            documentGrid.addColumn("currentStatus", "ìƒíƒœ", 80);
            documentGrid.addColumn("priority", "ìš°ì„ ìˆœìœ„", 80);
            documentGrid.addColumn("assignee", "ë‹´ë‹¹ì", 80);
            
            // ìƒíƒœ ì „í™˜ íŒ¨ë„
            var statusPanel = new nexacro.Container("statusPanel");
            statusPanel.set_left(620);
            statusPanel.set_top(10);
            statusPanel.set_width(370);
            statusPanel.set_height(250);
            statusPanel.set_background("lightgray");
            statusPanel.set_border("1px solid #ccc");
            
            var statusTitle = new nexacro.Label("statusTitle");
            statusTitle.set_text("ìƒíƒœ ì „í™˜");
            statusTitle.set_left(10);
            statusTitle.set_top(10);
            statusTitle.set_width(350);
            statusTitle.set_height(25);
            statusTitle.set_font("bold 14px Arial");
            statusTitle.set_background("darkgray");
            statusTitle.set_color("white");
            
            var currentStatusLabel = new nexacro.Label("currentStatusLabel");
            currentStatusLabel.set_text("í˜„ì¬ ìƒíƒœ: -");
            currentStatusLabel.set_left(10);
            currentStatusLabel.set_top(45);
            currentStatusLabel.set_width(350);
            currentStatusLabel.set_height(25);
            currentStatusLabel.set_font("bold 12px Arial");
            
            var statusFlowLabel = new nexacro.Label("statusFlowLabel");
            statusFlowLabel.set_text("ìƒíƒœ íë¦„: ì‹ ê·œ â†’ ì‘ì„±ì¤‘ â†’ ê²€í† ì¤‘ â†’ ìŠ¹ì¸ëŒ€ê¸° â†’ ì™„ë£Œ/ë°˜ë ¤");
            statusFlowLabel.set_left(10);
            statusFlowLabel.set_top(75);
            statusFlowLabel.set_width(350);
            statusFlowLabel.set_height(40);
            statusFlowLabel.set_font("10px Arial");
            statusFlowLabel.set_background("lightyellow");
            
            // ìƒíƒœ ì „í™˜ ë²„íŠ¼ë“¤
            var submitButton = new nexacro.Button("submitButton");
            submitButton.set_text("ì œì¶œ");
            submitButton.set_left(10);
            submitButton.set_top(125);
            submitButton.set_width(80);
            submitButton.set_height(30);
            submitButton.set_background("lightblue");
            submitButton.set_visible(false);
            
            var reviewButton = new nexacro.Button("reviewButton");
            reviewButton.set_text("ê²€í† ì™„ë£Œ");
            reviewButton.set_left(100);
            reviewButton.set_top(125);
            reviewButton.set_width(80);
            reviewButton.set_height(30);
            reviewButton.set_background("lightgreen");
            reviewButton.set_visible(false);
            
            var approveButton = new nexacro.Button("approveButton");
            approveButton.set_text("ìŠ¹ì¸");
            approveButton.set_left(190);
            approveButton.set_top(125);
            approveButton.set_width(80);
            approveButton.set_height(30);
            approveButton.set_background("lightgreen");
            approveButton.set_visible(false);
            
            var rejectButton = new nexacro.Button("rejectButton");
            rejectButton.set_text("ë°˜ë ¤");
            rejectButton.set_left(280);
            rejectButton.set_top(125);
            rejectButton.set_width(80);
            rejectButton.set_height(30);
            rejectButton.set_background("lightcoral");
            rejectButton.set_visible(false);
            
            var returnButton = new nexacro.Button("returnButton");
            returnButton.set_text("ë°˜í™˜");
            returnButton.set_left(10);
            returnButton.set_top(165);
            returnButton.set_width(80);
            returnButton.set_height(30);
            returnButton.set_background("lightyellow");
            returnButton.set_visible(false);
            
            var completeButton = new nexacro.Button("completeButton");
            completeButton.set_text("ì™„ë£Œ");
            completeButton.set_left(100);
            completeButton.set_top(165);
            completeButton.set_width(80);
            completeButton.set_height(30);
            completeButton.set_background("lightgreen");
            completeButton.set_visible(false);
            
            // ì½”ë©˜íŠ¸ ì…ë ¥
            var commentLabel = new nexacro.Label("commentLabel");
            commentLabel.set_text("ì½”ë©˜íŠ¸:");
            commentLabel.set_left(10);
            commentLabel.set_top(205);
            commentLabel.set_width(60);
            commentLabel.set_height(20);
            
            var commentText = new nexacro.TextBox("commentText");
            commentText.set_left(80);
            commentText.set_top(205);
            commentText.set_width(280);
            commentText.set_height(20);
            commentText.set_placeholder("ìƒíƒœ ì „í™˜ ì‹œ ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
            
            // ìƒíƒœ íˆìŠ¤í† ë¦¬ ê·¸ë¦¬ë“œ
            var historyGrid = new nexacro.Grid("historyGrid");
            historyGrid.set_left(10);
            historyGrid.set_top(270);
            historyGrid.set_width(980);
            historyGrid.set_height(200);
            historyGrid.set_border("1px solid #ccc");
            historyGrid.set_dataset(statusHistoryDataset);
            
            historyGrid.addColumn("docId", "ë¬¸ì„œID", 80);
            historyGrid.addColumn("fromStatus", "ì´ì „ìƒíƒœ", 80);
            historyGrid.addColumn("toStatus", "ìƒˆìƒíƒœ", 80);
            historyGrid.addColumn("action", "ì•¡ì…˜", 100);
            historyGrid.addColumn("user", "ì‚¬ìš©ì", 80);
            historyGrid.addColumn("timestamp", "ì‹œê°„", 150);
            historyGrid.addColumn("comment", "ì½”ë©˜íŠ¸", 200);
            
            // ì•Œë¦¼ íŒ¨ë„
            var notificationPanel = new nexacro.Container("notificationPanel");
            notificationPanel.set_left(10);
            notificationPanel.set_top(480);
            notificationPanel.set_width(980);
            notificationPanel.set_height(110);
            notificationPanel.set_background("lightcyan");
            notificationPanel.set_border("1px solid #ccc");
            
            var notificationTitle = new nexacro.Label("notificationTitle");
            notificationTitle.set_text("ì•Œë¦¼ ë° ì´ë²¤íŠ¸");
            notificationTitle.set_left(10);
            notificationTitle.set_top(10);
            notificationTitle.set_width(960);
            notificationTitle.set_height(25);
            notificationTitle.set_font("bold 14px Arial");
            notificationTitle.set_background("darkcyan");
            notificationTitle.set_color("white");
            
            var notificationText = new nexacro.Label("notificationText");
            notificationText.set_text("ë¬¸ì„œë¥¼ ì„ íƒí•˜ë©´ ê´€ë ¨ ì•Œë¦¼ì´ í‘œì‹œë©ë‹ˆë‹¤");
            notificationText.set_left(10);
            notificationText.set_top(45);
            notificationText.set_width(960);
            notificationText.set_height(55);
            notificationText.set_background("white");
            notificationText.set_border("1px solid #ccc");
            
            /*
                ===== 3ë‹¨ê³„: ì›Œí¬í”Œë¡œìš° ìƒíƒœ ì •ì˜ =====
            */
            var workflowStates = {
                "ì‹ ê·œ": {
                    nextStates: ["ì‘ì„±ì¤‘"],
                    actions: ["ì‘ì„±ì‹œì‘"],
                    allowedUsers: ["ì‘ì„±ì"]
                },
                "ì‘ì„±ì¤‘": {
                    nextStates: ["ê²€í† ì¤‘", "ì‹ ê·œ"],
                    actions: ["ì œì¶œ", "ì·¨ì†Œ"],
                    allowedUsers: ["ì‘ì„±ì"]
                },
                "ê²€í† ì¤‘": {
                    nextStates: ["ìŠ¹ì¸ëŒ€ê¸°", "ì‘ì„±ì¤‘"],
                    actions: ["ê²€í† ì™„ë£Œ", "ë°˜í™˜"],
                    allowedUsers: ["ê²€í† ì"]
                },
                "ìŠ¹ì¸ëŒ€ê¸°": {
                    nextStates: ["ì™„ë£Œ", "ë°˜ë ¤", "ê²€í† ì¤‘"],
                    actions: ["ìŠ¹ì¸", "ë°˜ë ¤", "ë°˜í™˜"],
                    allowedUsers: ["ìŠ¹ì¸ì"]
                },
                "ì™„ë£Œ": {
                    nextStates: [],
                    actions: [],
                    allowedUsers: []
                },
                "ë°˜ë ¤": {
                    nextStates: ["ì‘ì„±ì¤‘"],
                    actions: ["ì¬ì‘ì„±"],
                    allowedUsers: ["ì‘ì„±ì"]
                }
            };
            
            var currentUser = "ê¹€ì² ìˆ˜"; // í˜„ì¬ ì‚¬ìš©ì (ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ ì •ë³´ì—ì„œ ê°€ì ¸ì˜´)
            var selectedDocument = null;
            
            /*
                ===== 4ë‹¨ê³„: ì›Œí¬í”Œë¡œìš° í•¨ìˆ˜ë“¤ =====
            */
            
            /*
                ë¬¸ì„œ ì„ íƒ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
            */
            function updateDocumentSelection(docId) {
                selectedDocument = docId;
                
                // ì„ íƒëœ ë¬¸ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                var docInfo = null;
                for (var i = 0; i < documentDataset.getRowCount(); i++) {
                    if (documentDataset.getCellData(i, "docId") === docId) {
                        docInfo = {
                            docId: documentDataset.getCellData(i, "docId"),
                            title: documentDataset.getCellData(i, "title"),
                            author: documentDataset.getCellData(i, "author"),
                            currentStatus: documentDataset.getCellData(i, "currentStatus"),
                            assignee: documentDataset.getCellData(i, "assignee")
                        };
                        break;
                    }
                }
                
                if (docInfo) {
                    currentStatusLabel.set_text("í˜„ì¬ ìƒíƒœ: " + docInfo.currentStatus);
                    updateStatusButtons(docInfo.currentStatus, docInfo.author, docInfo.assignee);
                    updateNotification(docInfo);
                    updateHistoryGrid(docId);
                }
            }
            
            /*
                ìƒíƒœ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            */
            function updateStatusButtons(currentStatus, author, assignee) {
                // ëª¨ë“  ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                submitButton.set_visible(false);
                reviewButton.set_visible(false);
                approveButton.set_visible(false);
                rejectButton.set_visible(false);
                returnButton.set_visible(false);
                completeButton.set_visible(false);
                
                // í˜„ì¬ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í‘œì‹œ
                var stateInfo = workflowStates[currentStatus];
                if (stateInfo) {
                    for (var i = 0; i < stateInfo.actions.length; i++) {
                        var action = stateInfo.actions[i];
                        switch (action) {
                            case "ì œì¶œ":
                                if (author === currentUser) {
                                    submitButton.set_visible(true);
                                }
                                break;
                            case "ê²€í† ì™„ë£Œ":
                                if (assignee === currentUser) {
                                    reviewButton.set_visible(true);
                                }
                                break;
                            case "ìŠ¹ì¸":
                                if (assignee === currentUser) {
                                    approveButton.set_visible(true);
                                }
                                break;
                            case "ë°˜ë ¤":
                                if (assignee === currentUser) {
                                    rejectButton.set_visible(true);
                                }
                                break;
                            case "ë°˜í™˜":
                                if (assignee === currentUser) {
                                    returnButton.set_visible(true);
                                }
                                break;
                            case "ì¬ì‘ì„±":
                                if (author === currentUser) {
                                    completeButton.set_visible(true);
                                    completeButton.set_text("ì¬ì‘ì„±");
                                }
                                break;
                        }
                    }
                }
            }
            
            /*
                ìƒíƒœ ì „í™˜ ì‹¤í–‰
            */
            function executeStatusTransition(action, newStatus) {
                if (!selectedDocument) {
                    alert("ë¬¸ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
                    return;
                }
                
                var comment = commentText.get_text();
                if (!comment) {
                    comment = action + " ì²˜ë¦¬";
                }
                
                // í˜„ì¬ ë¬¸ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                var currentStatus = "";
                for (var i = 0; i < documentDataset.getRowCount(); i++) {
                    if (documentDataset.getCellData(i, "docId") === selectedDocument) {
                        currentStatus = documentDataset.getCellData(i, "currentStatus");
                        documentDataset.setCellData(i, "currentStatus", newStatus);
                        break;
                    }
                }
                
                // íˆìŠ¤í† ë¦¬ ì¶”ê°€
                var newHistoryRow = statusHistoryDataset.addRow();
                statusHistoryDataset.setCellData(newHistoryRow, "historyId", statusHistoryDataset.getRowCount() + 1);
                statusHistoryDataset.setCellData(newHistoryRow, "docId", selectedDocument);
                statusHistoryDataset.setCellData(newHistoryRow, "fromStatus", currentStatus);
                statusHistoryDataset.setCellData(newHistoryRow, "toStatus", newStatus);
                statusHistoryDataset.setCellData(newHistoryRow, "action", action);
                statusHistoryDataset.setCellData(newHistoryRow, "user", currentUser);
                statusHistoryDataset.setCellData(newHistoryRow, "timestamp", new Date().toLocaleString());
                statusHistoryDataset.setCellData(newHistoryRow, "comment", comment);
                
                // UI ì—…ë°ì´íŠ¸
                updateDocumentSelection(selectedDocument);
                commentText.set_text("");
                
                // ì•Œë¦¼ í‘œì‹œ
                showNotification("ìƒíƒœê°€ '" + currentStatus + "'ì—ì„œ '" + newStatus + "'ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
            
            /*
                íˆìŠ¤í† ë¦¬ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
            */
            function updateHistoryGrid(docId) {
                var filteredHistory = new nexacro.Dataset("filteredHistory");
                filteredHistory.addColumn("docId", "number");
                filteredHistory.addColumn("fromStatus", "string");
                filteredHistory.addColumn("toStatus", "string");
                filteredHistory.addColumn("action", "string");
                filteredHistory.addColumn("user", "string");
                filteredHistory.addColumn("timestamp", "string");
                filteredHistory.addColumn("comment", "string");
                
                for (var i = 0; i < statusHistoryDataset.getRowCount(); i++) {
                    if (statusHistoryDataset.getCellData(i, "docId") === docId) {
                        var newRow = filteredHistory.addRow();
                        filteredHistory.setCellData(newRow, "docId", statusHistoryDataset.getCellData(i, "docId"));
                        filteredHistory.setCellData(newRow, "fromStatus", statusHistoryDataset.getCellData(i, "fromStatus"));
                        filteredHistory.setCellData(newRow, "toStatus", statusHistoryDataset.getCellData(i, "toStatus"));
                        filteredHistory.setCellData(newRow, "action", statusHistoryDataset.getCellData(i, "action"));
                        filteredHistory.setCellData(newRow, "user", statusHistoryDataset.getCellData(i, "user"));
                        filteredHistory.setCellData(newRow, "timestamp", statusHistoryDataset.getCellData(i, "timestamp"));
                        filteredHistory.setCellData(newRow, "comment", statusHistoryDataset.getCellData(i, "comment"));
                    }
                }
                
                historyGrid.set_dataset(filteredHistory);
            }
            
            /*
                ì•Œë¦¼ ì—…ë°ì´íŠ¸
            */
            function updateNotification(docInfo) {
                var notification = "ğŸ“‹ ë¬¸ì„œ ì •ë³´\n";
                notification += "ì œëª©: " + docInfo.title + "\n";
                notification += "ì‘ì„±ì: " + docInfo.author + "\n";
                notification += "í˜„ì¬ ìƒíƒœ: " + docInfo.currentStatus + "\n";
                notification += "ë‹´ë‹¹ì: " + docInfo.assignee + "\n\n";
                
                // ìƒíƒœë³„ ì•Œë¦¼ ë©”ì‹œì§€
                switch (docInfo.currentStatus) {
                    case "ì‘ì„±ì¤‘":
                        notification += "âš ï¸ ë¬¸ì„œê°€ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤. ì‘ì„± ì™„ë£Œ í›„ ì œì¶œí•´ì£¼ì„¸ìš”.";
                        break;
                    case "ê²€í† ì¤‘":
                        notification += "ğŸ” ë¬¸ì„œê°€ ê²€í†  ì¤‘ì…ë‹ˆë‹¤. ê²€í†  ì™„ë£Œ í›„ ìŠ¹ì¸ ìš”ì²­í•´ì£¼ì„¸ìš”.";
                        break;
                    case "ìŠ¹ì¸ëŒ€ê¸°":
                        notification += "â³ ë¬¸ì„œê°€ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤. ìŠ¹ì¸ ë˜ëŠ” ë°˜ë ¤ ì²˜ë¦¬í•´ì£¼ì„¸ìš”.";
                        break;
                    case "ì™„ë£Œ":
                        notification += "âœ… ë¬¸ì„œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
                        break;
                    case "ë°˜ë ¤":
                        notification += "âŒ ë¬¸ì„œê°€ ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ì¬ì œì¶œí•´ì£¼ì„¸ìš”.";
                        break;
                }
                
                notificationText.set_text(notification);
            }
            
            /*
                ì•Œë¦¼ í‘œì‹œ
            */
            function showNotification(message) {
                var currentTime = new Date().toLocaleTimeString();
                var fullMessage = "[" + currentTime + "] " + message;
                
                // ê¸°ì¡´ ì•Œë¦¼ì— ìƒˆ ë©”ì‹œì§€ ì¶”ê°€
                var existingText = notificationText.get_text();
                notificationText.set_text(fullMessage + "\n" + existingText);
                
                // 3ì´ˆ í›„ ì•Œë¦¼ ìë™ ì œê±° (ì„ íƒì‚¬í•­)
                setTimeout(function() {
                    // ì•Œë¦¼ ì œê±° ë¡œì§
                }, 5000);
            }
            
            /*
                ===== 5ë‹¨ê³„: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—°ê²° =====
            */
            
            // ë¬¸ì„œ ê·¸ë¦¬ë“œ ì´ë²¤íŠ¸
            documentGrid.addEventHandler("onrowchanged", function() {
                var selectedRow = documentGrid.get_selectedrow();
                if (selectedRow >= 0) {
                    var docId = documentDataset.getCellData(selectedRow, "docId");
                    updateDocumentSelection(docId);
                }
            });
            
            // ìƒíƒœ ì „í™˜ ë²„íŠ¼ ì´ë²¤íŠ¸
            submitButton.addEventHandler("onclick", function() {
                executeStatusTransition("ì œì¶œ", "ê²€í† ì¤‘");
            });
            
            reviewButton.addEventHandler("onclick", function() {
                executeStatusTransition("ê²€í† ì™„ë£Œ", "ìŠ¹ì¸ëŒ€ê¸°");
            });
            
            approveButton.addEventHandler("onclick", function() {
                executeStatusTransition("ìŠ¹ì¸", "ì™„ë£Œ");
            });
            
            rejectButton.addEventHandler("onclick", function() {
                executeStatusTransition("ë°˜ë ¤", "ë°˜ë ¤");
            });
            
            returnButton.addEventHandler("onclick", function() {
                var currentStatus = "";
                for (var i = 0; i < documentDataset.getRowCount(); i++) {
                    if (documentDataset.getCellData(i, "docId") === selectedDocument) {
                        currentStatus = documentDataset.getCellData(i, "currentStatus");
                        break;
                    }
                }
                
                var returnStatus = "";
                switch (currentStatus) {
                    case "ê²€í† ì¤‘":
                        returnStatus = "ì‘ì„±ì¤‘";
                        break;
                    case "ìŠ¹ì¸ëŒ€ê¸°":
                        returnStatus = "ê²€í† ì¤‘";
                        break;
                }
                
                if (returnStatus) {
                    executeStatusTransition("ë°˜í™˜", returnStatus);
                }
            });
            
            completeButton.addEventHandler("onclick", function() {
                if (completeButton.get_text() === "ì¬ì‘ì„±") {
                    executeStatusTransition("ì¬ì‘ì„±", "ì‘ì„±ì¤‘");
                } else {
                    executeStatusTransition("ì™„ë£Œ", "ì™„ë£Œ");
                }
            });
            
            /*
                ===== 6ë‹¨ê³„: ì´ˆê¸° ì„¤ì • =====
            */
            // ì²« ë²ˆì§¸ ë¬¸ì„œ ì„ íƒ
            if (documentDataset.getRowCount() > 0) {
                documentGrid.set_selectedrow(0);
                var firstDocId = documentDataset.getCellData(0, "docId");
                updateDocumentSelection(firstDocId);
            }
            
            /*
                ===== 7ë‹¨ê³„: ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ í™”ë©´ì— ì¶”ê°€ =====
            */
            this.add(titleLabel);
            this.add(mainContainer);
            this.add(documentGrid);
            this.add(statusPanel);
            this.add(statusTitle);
            this.add(currentStatusLabel);
            this.add(statusFlowLabel);
            this.add(submitButton);
            this.add(reviewButton);
            this.add(approveButton);
            this.add(rejectButton);
            this.add(returnButton);
            this.add(completeButton);
            this.add(commentLabel);
            this.add(commentText);
            this.add(historyGrid);
            this.add(notificationPanel);
            this.add(notificationTitle);
            this.add(notificationText);
            
            /*
                ===== ì •ë¦¬ =====
                ì´ ì˜ˆì œì—ì„œ ë°°ìš´ ì›Œí¬í”Œë¡œìš°ì™€ ìƒíƒœ ê´€ë¦¬ ê¸°ëŠ¥ë“¤:
                
                1. ìƒíƒœ ê¸°ë°˜ ì›Œí¬í”Œë¡œìš°:
                   - ë¬¸ì„œì˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬
                   - ìƒíƒœ ì „í™˜ ê·œì¹™ ì •ì˜
                   - ê¶Œí•œ ê¸°ë°˜ ì•¡ì…˜ ì œì–´
                
                2. ìƒíƒœ ì „í™˜ ê´€ë¦¬:
                   - í˜„ì¬ ìƒíƒœì— ë”°ë¥¸ ê°€ëŠ¥í•œ ì•¡ì…˜ í‘œì‹œ
                   - ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¥¸ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
                   - ìƒíƒœ ì „í™˜ ì‹œ ê²€ì¦ ë¡œì§
                
                3. íˆìŠ¤í† ë¦¬ ì¶”ì :
                   - ëª¨ë“  ìƒíƒœ ë³€ê²½ ì´ë ¥ ê¸°ë¡
                   - ì‚¬ìš©ì, ì‹œê°„, ì½”ë©˜íŠ¸ ì •ë³´ ì €ì¥
                   - ê°ì‚¬ ì¶”ì  (Audit Trail)
                
                4. ì•Œë¦¼ ì‹œìŠ¤í…œ:
                   - ìƒíƒœë³„ ì•Œë¦¼ ë©”ì‹œì§€
                   - ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì•Œë¦¼
                   - ì‚¬ìš©ì ì¹œí™”ì ì¸ í”¼ë“œë°±
                
                5. ê¶Œí•œ ê´€ë¦¬:
                   - ì—­í•  ê¸°ë°˜ ì•¡ì…˜ ì œì–´
                   - ì‚¬ìš©ìë³„ ê¶Œí•œ í™•ì¸
                   - ë³´ì•ˆ ê°•í™”
                
                6. ì‚¬ìš©ì ê²½í—˜:
                   - ì§ê´€ì ì¸ ìƒíƒœ í‘œì‹œ
                   - ëª…í™•í•œ ì•¡ì…˜ ë²„íŠ¼
                   - ì‹¤ì‹œê°„ í”¼ë“œë°±
                
                ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ”:
                - ë” ë³µì¡í•œ ì›Œí¬í”Œë¡œìš° ê·œì¹™
                - ë‹¤ì¤‘ ìŠ¹ì¸ì ì§€ì›
                - ë³‘ë ¬ ì²˜ë¦¬ ì§€ì›
                - ì´ë©”ì¼ ì•Œë¦¼ ì—°ë™
                - ëª¨ë°”ì¼ ì§€ì›
                - API ì—°ë™
                
                ì´ì œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì›Œí¬í”Œë¡œìš° ì‹œìŠ¤í…œì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
            */
        }
    </script>
</body>
</html>
